const { Console } = require('console');
const fs = require('fs');
const venvLocal = require('./Models/venvLocal');
const vquery = require('./Models/vquery');
const connection = require('./Models/zconn');
const Models = require('./modelsnew/model')


process.setMaxListeners(0);

const sleep = (milliseconds) => {
  return new Promise(resolve => setTimeout(resolve, milliseconds))
} 
 

const doitBro = async () => {
    try {    
      const start = new Date();
      console.log("Running At : " + start)   
      while(true){         
          (async ()=>{
              try{   
                  const results = await Models.getListIp(); 
                  
                  results.forEach( async (r) => { 
                    /* delete from rrak_mrrak where account='510073' and seq=16;
                    insert into pos.rrak_mrrak (RECID,ACCOUNT,SEQ,KETER,KHS,QTY1BLN,rp1bln,QTY3BLN,rp3bln,QTY6BLN,rp6bln,QTY1thn,rp1thn,qtyjumlah,rpjumlah,nomor)
                    values ('', '510073', '16', 'Handsoap', '', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 47); */
                    const queryTembakx= ` 
                    delete from rrak_mrrak;    
                    INSERT INTO rrak_mrrak (RECID,ACCOUNT,SEQ,KETER,KHS,qty1bln,rp1bln,qty3bln,rp3bln,qty6bln,rp6bln,qty1thn,rp1thn,qtyJumlah,rpJumlah,nomor) VALUES
                    ('','510000',1,'Listrik','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1),
                    ('','510001',1,'PDAM','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2),
                    ('','510003',1,'BBM ( Kendaraan Delivery )','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,3),
                    ('','510004',1,'BBM Genzet','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,4),
                    ('','510005',1,'Telepon (Pulsa)','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,5),
                    ('','510008',1,'Alat Tulis Kantor','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,6),
                    ('','510008',2,'Spidol','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,7),
                    ('','510009',1,'Cutter','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,8),
                    ('','510009',2,'FotoCopy + Laminating','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9),
                    ('','510009',3,'Gunting','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,10),
                    ('','510009',4,'Isi Staples','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,11),
                    ('','510009',5,'Karet Gelang','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,12),
                    ('','510009',6,'Lem','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,13),
                    ('','510009',8,'Plakban','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,15),
                    ('','510009',9,'Selotip','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,16),
                    ('','510009',10,'Staples','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,17),
                    ('','510009',11,'Tali Rapia','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,18),
                    ('','510009',12,'Selotip Kecil','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,19),
                    ('','510009',13,'Isi Cutter','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,20),
                    ('','510009',14,'Lampu','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,21),
                    ('','510016',1,'Pemeliharaan Kendaraan','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,22),
                    ('','510024',1,'Lem Tikus','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,23),
                    ('','510035',1,'Babinsa/ Bimaspol','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,24),
                    ('','510035',2,'Iuran Keamanan Toko','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,25),
                    ('','510035',3,'Iuran Kebersihan','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,26),
                    ('','510035',4,'Iuran RT/RW','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,27),
                    ('','510035',5,'Iuran Parkir','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,28),
                    ('','510036',1,'Sumbangan','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,29),
                    ('','510059',1,'Parkir Motor ( Setor bank)','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,30),
                    ('','510072',1,'Air Minum','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,31),
                    ('','510073',1,'Ember','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,32),
                    ('','510073',2,'Kamper','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,33),
                    ('','510073',3,'Kanebo','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,34),
                    ('','510073',4,'Karbol','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,35),
                    ('','510073',5,'Lap Serbet','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,36),
                    ('','510073',6,'Pembersih Kaca','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,37),
                    ('','510073',7,'Pembersih Piring','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,38),
                    ('','510073',8,'Pembersih Lantai','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,39),
                    ('','510073',9,'Pengharum Ruangan','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,40),
                    ('','510073',10,'Plastik Sampah','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,41),
                    ('','510073',11,'Refill Pel','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,42),
                    ('','510073',12,'Sapu','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,43),
                    ('','510073',13,'Spons/ Sabut','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,44),
                    ('','510073',14,'Vim','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,45),
                    ('','510073',15,'Tissue Toilet','',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,46),
                    ('','510073',16,'Handsoap','0',0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,47);
                    `
                                      
                    
                    const rv = await Models.vqueryTembak(r.ip1, queryTembakx)
                  
                   if(rv === "Gagal"){
                      console.log(r.kdtk +'|'+ r.kdcab +'|Gagal') 
                    }else{                       
                        console.log(r.kdtk +'|'+ r.kdcab +'|Sukses|' + r.ip1)
                    }
                  
                  })   
                 
              }catch(err){
                console.log("Sini Ketnya : " + err) 
                return true
              }

          })(); 
        await sleep(360000)            
      }
    } catch (e) {
      console.log("Sini 2" + e);
      //doitBro()
    } 
}
 
doitBro()